<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PEDIDOS</title>
  <link rel="stylesheet" href="styles.css">
  <meta name="description" content="Compra en el mejor supermercado para tel√©fonos m√≥viles.">
  <link rel="icon" href="favicon.ico" type="image/x-icon">
</head>
<body>
  <!-- Formulario de login -->
  <div id="login-container">
    <form id="login-form">
      <input type="text" id="username" placeholder="Usuario" required>
      <input type="password" id="password" placeholder="Contrase√±a" required>
      <button type="submit">Iniciar Sesi√≥n</button>
    </form>
  </div>
  
  <!-- Contenido protegido: se mostrar√° una vez que el usuario inicie sesi√≥n -->
  <div id="contenido" style="display:none;">
    <header>
      <h1>PEDIDOS</h1>
      <!-- Bot√≥n para cambiar contrase√±a -->
      <button id="change-password-btn">Cambiar Contrase√±a</button>
    </header>
    <main>
      <!-- Contenedor de productos -->
      <section id="product-list"></section>
    </main>
    
    <!-- Total siempre visible -->
    <div id="total-display" aria-live="polite">Total: ‚Ç¨0.00</div>
    
    <!-- Bot√≥n flotante del carrito (movible) -->
    <button id="cart-toggle" aria-label="Ver carrito">üõí</button>
    
    <!-- Modal del carrito -->
    <div id="cart-modal" role="dialog" aria-modal="true" aria-labelledby="cart-modal-title">
      <div id="cart-modal-content">
        <button id="close-modal" aria-label="Cerrar carrito" onclick="toggleCart()">‚úñ</button>
        <h2 id="cart-modal-title">Tu Pedido</h2>
        <div id="cart-items-modal">No hay productos a√±adidos.</div>
        <div id="modal-total">Total: ‚Ç¨0.00</div>
        <button id="submit-order" onclick="submitOrder()">Enviar Pedido</button>
      </div>
    </div>
    
    <!-- Elemento de audio para notificar al agregar producto -->
    <audio id="add-sound" src="beep.mp3" preload="auto"></audio>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="script.js"></script>
  </div>
  
  <!-- Script de autenticaci√≥n y gesti√≥n de contrase√±a -->
  <script>
    // Array de usuarios v√°lidos (para este ejemplo, se gestiona localmente)
    const USERS = [
      { username: "ccipbcncrd8@grupocaher.com", store: "Alcampo Sant Boi", password: "1234" },
      { username: "ccipbcncrd4@grupocaher.com", store: "Alcampo Sant Quirze", password: "1234" },
      { username: "ccipbcncrd8@grupocaher.com",   store: "Alcampo Esplugues",  password: "2022" },
      { username: "USUARIO4",     store: "Alcampo Other1",    password: "1234" },
      { username: "USUARIO5",     store: "Alcampo Other2",    password: "1234" }
    ];

    // Al cargar la p√°gina, si existen credenciales guardadas, prellenamos los campos.
    document.addEventListener("DOMContentLoaded", function() {
      const savedUsername = localStorage.getItem("savedUsername");
      const savedPassword = localStorage.getItem("savedPassword");
      if (savedUsername && savedPassword) {
        document.getElementById("username").value = savedUsername;
        document.getElementById("password").value = savedPassword;
      }
    });

    // Funci√≥n para mostrar el contenido protegido tras el login
    function mostrarContenido() {
      document.getElementById("login-container").style.display = "none";
      document.getElementById("contenido").style.display = "block";
      // Mostrar el nombre del almac√©n en el header, si est√° almacenado
      const storeName = localStorage.getItem("userStore");
      if (storeName) {
        const header = document.querySelector("header h1");
        header.textContent += " - " + storeName;
      }
    }

    // Evento para el formulario de login
    document.getElementById("login-form").addEventListener("submit", function(e) {
      e.preventDefault();
      const usernameInput = document.getElementById("username").value.trim();
      const passwordInput = document.getElementById("password").value.trim();
      
      // Buscar usuario que coincida con las credenciales
      const userFound = USERS.find(user => user.username === usernameInput && user.password === passwordInput);
      
      if (userFound) {
        // Guardar las credenciales en localStorage para que se recuerden en el futuro
        localStorage.setItem("savedUsername", usernameInput);
        localStorage.setItem("savedPassword", passwordInput);
        localStorage.setItem("userStore", userFound.store);
        localStorage.setItem("loggedInUser", userFound.username);
        mostrarContenido();
      } else {
        alert("Credenciales incorrectas");
      }
    });

    // Bot√≥n para cambiar la contrase√±a
    document.getElementById("change-password-btn").addEventListener("click", function() {
      const newPassword = prompt("Introduce la nueva contrase√±a:");
      if (newPassword) {
        // Obtener el usuario actualmente logueado
        const currentUsername = localStorage.getItem("loggedInUser");
        if (!currentUsername) {
          alert("No se ha identificado el usuario.");
          return;
        }
        // Actualizar la contrase√±a en el localStorage para recordar el nuevo valor
        localStorage.setItem("savedPassword", newPassword);
        
        // Actualizar la contrase√±a en el array USERS (solo para este ejemplo; en un entorno real, esto se har√≠a en el servidor)
        const userIndex = USERS.findIndex(user => user.username === currentUsername);
        if (userIndex !== -1) {
          USERS[userIndex].password = newPassword;
          alert("Contrase√±a actualizada correctamente.");
        } else {
          alert("Error al actualizar la contrase√±a.");
        }
      }
    });
  </script>
</body>
</html>